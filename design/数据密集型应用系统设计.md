# 数据密集型应用系统设计

> 在我看来，计算机技术是一种流行文化。流行文化只在乎认同感和参与感，活在当下，从而不关心合作，过去或者未来。我认为大部分为金钱而编写代码的人也是如此。他们不了解他们的文化来自哪里。
>
> ——Alan Kay

## 前言

催生大数据及分布式系统的广泛应用的因素：

* 互联网公司，他们每天都在面对海量数据和负载，迫使其不断创新，并改进支撑系统以更有效地处理这种量级地数据
* 商业方面因素，如敏捷开发，测试驱动和对市场机会做出快速反应等，都要求尽量缩短产品开发周期，因此系统中的数据模型也要足够灵活以方便调整
* 免费及开源软件现在已经非常成功，在很多领域足以取代商业或定制软件
* 硬件方面，CPU主频增长日趋缓慢，而多核系统成为新常态，网络速度则依旧保持快速发展，这就意味着并行分布式系统将会成为业界主流
* 如今一个不起眼的小公司，也完全有能力构建起大型分布式系统：跨机器甚至跨地域的数据中心，因为现在有了逐渐普及的IaaS云服务
* 很多服务现在都要求高可用。道理很简单，系统失效或者维护实践越长，其损失代价越大，甚至大到无法承受

数据密集型应用系统：数据是其成败决定性因素，包括数据的规模，数据的复杂度或者数据产生与变化的速率等

计算密集型：CPU主频往往是后者最大的制约瓶颈

随着层出不穷的新技术，作为一名工程师更需要秉承严谨的态度，深入理解繁杂词汇背后系统设计所面临的优劣权衡，只有这样技术才能为我所用，构建好自己的系统。

## 数据系统基础

### 可靠，可扩展与可维护的应用系统

应用系统包含的标准组件：

* 数据库：用以存储数据
* 高速缓存：缓存那些复杂或者操作代价昂贵的结果， 用以加快下一次访问
* 索引：用户可以按关键字搜索数据并支持各种过滤
* 流式处理：持续发送消息至另一个进程，处理采用异步方式
* 批处理：定期处理大量的累计数据

#### 可靠性

当出现意外情况如硬件，软件故障，认为失误等，系统应可以继续正常运转，虽然性能可能有所降低，但确保功能正确

可能出错的事情称为错误或故障，系统可应对错误则称为容错或者弹性。容错总是针对特定类型的故障。故障与失效不完全一致，故障通常被定义为组件偏离其正常规格，而失效意味系统作为一个整体停止，无法像用户提供所需的服务。我们不太可能将故障概率降低到零，因此通常设计容错机制来避免从故障引发系统失效。

故障：

1. 硬件故障：通过硬件冗余（RAID，服务器双电源，热插拔CPU，备用电源，发电机等），当一个组件发生故障时，冗余组件可以快速结果，之后再更换失效的组件。通过软件容错的方式，例如滚动更新
2. 软件错误：
3. 人为错误：



> 容错系统中，为了测试目的，可以故意提高故障发生概率，例如通过随机杀死某个进程，来确保系统仍保持健壮。很多关键的bug实际上正是由于错误处理不当而造成的，通过这种故意引发故障的方式，来持续检验，测试系统的容错机制，增加对真实发生故障时应对的信息。Netflix的Chaos Monkey系统就是这种测试的典型例子。

 #### 可扩展性

随着规模的增长，例如数据量，流量或复杂性，系统应以合理的方式来匹配这种增长。可扩展性是用来描述系统应对负载增加能力的术语。

#### 可维护性

随着时间的推移，许多新的人员参与到系统开发和运维，以维护现有功能或适配新场景等，系统都应高效运转。

我们可以从软件设计时开始考虑，尽可能减少维护期间的麻烦，甚至避免造出容易过期的系统。为此，我们将特别关注软件系统的三个设计原则：

##### 可运维性

方便运营团队来保持系统平稳运行

##### 简单性

简化系统复杂性，使新工程师能够轻松理解系统。

##### 可演化性

后续工程师能够轻松地对系统进行改进，并根据需求变化将其适配到非典型场景，也称为可延伸性，易修改性或可塑性

### 数据模型与查询语言

#### 数据模型

数据模型可能是开发软件最重要的部分，它不仅对软件的编写方式，而且还对如何思考待解决的问题都有深远的影响。大多数应用程序是通过一层一层叠加数据模型来构建的，每层都通过提供一个简洁的数据模型来隐藏下层的复杂性。

关系模型



文档模型

采用NoSQL数据库的几个驱动因素：

* 比关系数据库更好的扩展性需求，包括支持超大数据集或超高写入吞吐量
* 普遍偏爱免费和开源软件而不是商业数据库产品
* 关系模型不能很好地支持一些特定的查询操作
* 对关系模型的一些限制性感到沮丧，渴望更具动态和表达力的数据模型

#### 数据查询语言

声明式：只需指定所需的数据模式，结果需要满足什么条件，以及如何转换数据，而不需要指明如何实现这一目标

命令式：告诉计算机以特定顺序执行某些操作，你完全可以推理整个过程，逐行遍历代码，评估相关条件，更新对应的变量，并决定是否再循环一遍

### 数据存储与检索



## 分布式数据系统

## 派生数据

## 附录

### 名词自查

RAID：独立硬盘冗余阵列，简称磁盘阵列。利用虚拟化存储技术，把多个硬盘组合在一起，成为一个或多个磁盘阵列组，目的为提升性能或数据冗余，或是二者同时提升。

Spanner：Google开发的一款全球级分布式关系数据库管理系统